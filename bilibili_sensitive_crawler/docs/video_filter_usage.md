# 视频过滤功能使用说明

## 功能概述

视频过滤功能允许您管理已下载的视频文件，特别是删除超出指定时长的视频及其对应的JSON元数据文件。

## 主要功能

1. **列出超长视频**: 显示所有超出指定时长的视频信息
2. **删除超长视频**: 删除超出指定时长的视频文件及其元数据
3. **试运行模式**: 预览将要删除的文件，不实际执行删除操作
4. **生成删除报告**: 记录删除操作的详细信息

## 命令行参数

### 基本参数

- `--list-long-videos`: 列出超出指定时长的视频（不删除）
- `--delete-long-videos`: 删除超出指定时长的视频及其元数据文件
- `--max-duration <秒数>`: 设置最大允许视频时长（默认: 30秒）
- `--dry-run`: 试运行模式，不实际删除文件
- `--generate-report`: 生成删除操作报告

## 使用示例

### 1. 列出超出30秒的视频

```bash
python main.py --list-long-videos --max-duration 30
```

### 2. 列出超出60秒的视频

```bash
python main.py --list-long-videos --max-duration 60
```

### 3. 试运行删除超出30秒的视频

```bash
python main.py --delete-long-videos --max-duration 30 --dry-run
```

### 4. 实际删除超出30秒的视频并生成报告

```bash
python main.py --delete-long-videos --max-duration 30 --generate-report
```

### 5. 删除超出45秒的视频（试运行）

```bash
python main.py --delete-long-videos --max-duration 45 --dry-run --generate-report
```

## 工作原理

### 时长检测方法

视频过滤器使用以下方法检测视频时长：

1. **从JSON元数据获取**: 优先从已保存的JSON文件中读取时长信息
2. **从视频文件获取**: 如果元数据中没有时长信息，使用FFprobe直接分析视频文件

### 支持的元数据字段

程序会尝试从以下JSON字段获取时长信息：
- `duration`
- `video_info.duration`
- `pages[0].duration`
- `stat.duration`

### 删除操作

当执行删除操作时，程序会：
1. 扫描所有JSON元数据文件
2. 检测每个视频的时长
3. 找到对应的视频文件
4. 删除超出时长限制的视频文件和JSON文件
5. 生成统计报告

## 安全特性

### 确认机制
- 非试运行模式下，程序会要求用户确认删除操作
- 试运行模式可以安全预览将要删除的文件

### 详细日志
- 记录所有操作过程
- 显示文件大小和释放的存储空间
- 记录删除失败的文件

### 报告生成
- 生成JSON格式的详细删除报告
- 包含时间戳、统计信息和删除的文件列表

## 输出示例

### 列出超长视频
```
找到 5 个超出 30 秒的视频:
================================================================================
  1. BV1234567890 - 45秒 - 12.34MB
     状态: 视频文件: 1个, 元数据: 存在
  2. BV0987654321 - 67秒 - 23.45MB
     状态: 视频文件: 1个, 元数据: 存在
================================================================================
总计: 5 个视频，占用空间: 89.12MB
```

### 删除操作统计
```
==================================================
删除操作统计:
找到超长视频: 5 个
删除视频文件: 5 个
删除元数据文件: 5 个
删除失败: 0 个
释放空间: 89.12 MB
==================================================
```

## 注意事项

1. **备份重要数据**: 删除操作不可逆，建议先备份重要文件
2. **FFprobe依赖**: 如果元数据中没有时长信息，需要系统安装FFprobe
3. **文件权限**: 确保程序有删除目标文件的权限
4. **网络无关**: 此功能仅操作本地文件，不需要网络连接

## 故障排除

### 常见问题

1. **无法获取视频时长**
   - 检查JSON元数据文件格式
   - 确认FFprobe已正确安装
   - 检查视频文件是否损坏

2. **删除失败**
   - 检查文件权限
   - 确认文件未被其他程序占用
   - 检查磁盘空间

3. **找不到视频文件**
   - 检查配置文件中的路径设置
   - 确认视频文件和元数据文件在正确位置

### 调试模式

使用 `--debug` 参数获取详细的调试信息：

```bash
python main.py --list-long-videos --max-duration 30 --debug
``` 